<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل دخول المترشح - Auto École Ben Cheikh</title>
<style>
body { font-family: Arial; direction: rtl; background: linear-gradient(135deg, #74ABE2, #5563DE); color: #fff; margin:0; padding:0; }
header { text-align:center; padding:40px 20px; }
header h1 { font-size:36px; margin:0; }
section { background: rgba(255,255,255,0.1); max-width:500px; margin:auto; padding:30px; border-radius:12px; }
input, button { padding:12px; font-size:16px; border-radius:6px; border:none; }
input { border:1px solid #fff; background:rgba(255,255,255,0.2); color:#fff; }
input::placeholder { color:#eee; }
button { background:#004aad; color:white; cursor:pointer; transition:0.3s; }
button:hover { background:#003080; }
.dashboard { margin-top:20px; background: rgba(255,255,255,0.2); padding:15px; border-radius:8px; }
ul { padding-left:20px; }
</style>
</head>
<body>

<header>
  <h1>تسجيل دخول المترشح</h1>
  <p>أدخل الاسم ورقم الهاتف لمتابعة الدروس والتقدم</p>
</header>

<section>
  <h2>تسجيل الدخول</h2>
  <form id="signinForm">
    <input type="text" id="name" placeholder="الاسم الكامل" required>
    <input type="tel" id="phone" placeholder="رقم الهاتف" required>
    <button type="submit">تسجيل الدخول</button>
  </form>

  <div class="dashboard" id="dashboard" style="display:none;">
    <h3>مرحباً، <span id="candidateName"></span></h3>
    <p>نوع الرخصة: <span id="candidateLicense"></span></p>
    <h4>الدروس:</h4>
    <ul id="lessonsList"></ul>
    <h4>التقدم:</h4>
    <ul id="progressList"></ul>
  </div>
</section>

<script>
const API_URL = "https://sheetdb.io/api/v1/o1glqkhxgb58a";
let currentCandidate = null;

// تحديث لوحة المترشح
function updateCandidateDashboard(candidate){
  document.getElementById('candidateName').textContent = candidate.name;
  document.getElementById('candidateLicense').textContent = candidate.license;

  const lessons = candidate.lessons ? JSON.parse(candidate.lessons) : [];
  const progress = candidate.progress ? JSON.parse(candidate.progress) : [];

  document.getElementById('lessonsList').innerHTML = lessons.length 
    ? lessons.map(l=>`<li>${l.title} - ${l.note} (${l.date})</li>`).join('')
    : "<li>لا يوجد دروس مسجلة بعد</li>";

  document.getElementById('progressList').innerHTML = progress.length
    ? progress.map(p=>`<li>${p.value}% - ${p.note} (${p.date})</li>`).join('')
    : "<li>لا يوجد تقدم مسجل بعد</li>";
}

// تسجيل دخول
document.getElementById('signinForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();

  const res = await fetch(API_URL);
  const candidates = await res.json();

  const candidate = candidates.find(c => c.name === name && c.phone === phone);
  if(!candidate){
    alert("المترشح غير موجود! تأكد من الاسم ورقم الهاتف.");
    return;
  }

  currentCandidate = candidate;
  document.getElementById('signinForm').style.display = 'none';
  document.getElementById('dashboard').style.display = 'block';
  updateCandidateDashboard(candidate);
});
</script>

</body>
</html>
