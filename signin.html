<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل دخول المترشح - Auto École Ben Cheikh</title>
<style>
body { font-family: Arial; direction: rtl; background: linear-gradient(135deg, #74ABE2, #5563DE); color: #fff; margin:0; padding:0; }
header { text-align:center; padding:40px 20px; }
header h1 { font-size:36px; margin:0; }
section { background: rgba(255,255,255,0.1); max-width:500px; margin:auto; padding:30px; border-radius:12px; }
input, button { padding:12px; font-size:16px; border-radius:6px; border:none; width:100%; margin-bottom:10px; }
input { border:1px solid #fff; background:rgba(255,255,255,0.2); color:#fff; }
input::placeholder { color:#eee; }
button { background:#004aad; color:white; cursor:pointer; transition:0.3s; }
button:hover { background:#003080; }
.dashboard { margin-top:20px; background: rgba(255,255,255,0.2); padding:20px; border-radius:8px; text-align:center; }
.option-btn { display:block; width:80%; margin:10px auto; padding:12px; font-size:18px; background:#0080ff; border-radius:6px; cursor:pointer; transition:0.3s; }
.option-btn:hover { background:#005bb5; }
.error { color: #ffdddd; background: #aa0000; padding:8px; border-radius:5px; margin-bottom:10px; display:none; }
</style>
</head>
<body>

<header>
  <h1>تسجيل دخول المترشح</h1>
  <p>أدخل الاسم ورقم الهاتف لمتابعة حسابك</p>
</header>

<section>
  <div id="errorMsg" class="error"></div>
  <form id="signinForm">
    <input type="text" id="name" placeholder="الاسم الكامل" required>
    <input type="tel" id="phone" placeholder="رقم الهاتف (06xxxxxxx)" required>
    <button type="submit">تسجيل الدخول</button>
  </form>

  <div class="dashboard" id="dashboard" style="display:none;">
    <h3>مرحباً، <span id="candidateName"></span></h3>
    <p>نوع الرخصة: <span id="candidateLicense"></span></p>

    <button class="option-btn" id="theoreticalBtn">الدروس النظرية</button>
    <button class="option-btn" id="practicalBtn">الدروس التطبيقية</button>
    <button class="option-btn" id="progressBtn">التقدم</button>
  </div>
</section>

<script>
const SHEETDB_API = "https://sheetdb.io/api/v1/o1glqkhxgb58a";
let currentCandidate = null;

// تسجيل الدخول
document.getElementById('signinForm').addEventListener('submit', async function(e){
  e.preventDefault();

  const nameInput = document.getElementById('name').value.trim().toLowerCase().replace(/\s+/g,"");
  let phoneInput = document.getElementById('phone').value.trim().replace(/\D/g,"");
  if(phoneInput.startsWith("0")) phoneInput = phoneInput.slice(1);

  const errorDiv = document.getElementById('errorMsg');
  errorDiv.style.display = "none";

  try{
    const res = await fetch(SHEETDB_API);
    const allCandidates = await res.json();

    const candidate = allCandidates.find(c => {
      const cName = (c.name || "").toLowerCase().replace(/\s+/g,"");
      let cPhone = String(c.phone || "").replace(/\D/g,"");
      if(cPhone.startsWith("0")) cPhone = cPhone.slice(1);
      return cName === nameInput && cPhone.slice(-9) === phoneInput.slice(-9);
    });

    if(!candidate){
      errorDiv.innerText = "المترشح غير موجود! تأكد من الاسم ورقم الهاتف.";
      errorDiv.style.display = "block";
      return;
    }

    currentCandidate = candidate;

    document.getElementById('signinForm').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';

    document.getElementById('candidateName').textContent = currentCandidate.name;
    document.getElementById('candidateLicense').textContent = currentCandidate.license;

  }catch(e){
    console.error("خطأ ف جلب البيانات", e);
    errorDiv.innerText = "حدث خطأ أثناء جلب البيانات. حاول لاحقاً.";
    errorDiv.style.display = "block";
  }
});

// إعادة التوجيه عند الضغط على كل زر
document.getElementById('theoreticalBtn').addEventListener('click', () => {
  window.location.href = "theoretical.html"; // ضع رابط صفحة الدروس النظرية
});

document.getElementById('practicalBtn').addEventListener('click', () => {
  window.location.href = "practical.html"; // ضع رابط صفحة الدروس التطبيقية
});

document.getElementById('progressBtn').addEventListener('click', () => {
  window.location.href = "progress.html"; // ضع رابط صفحة التقدم
});
</script>

</body>
</html>
